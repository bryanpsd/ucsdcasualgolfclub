---
import "~/styles/globals/global.css";
import "~/styles/globals/reset.css";
import "~/styles/globals/theme.css";

import { Hero } from "~components/Hero";
import { Player as PlayerComponent } from "~components/Player";

import Layout from "~layouts/Layout.astro";
import { contentfulClient } from "~services/contentful/contentful";
import { contentfulCache } from "~utils/contentfulCache";
import { transformPlayerResults } from "~utils/contentfulTransformers";

import * as styles from "~styles/globals/common.css";
import type { TypeLeadersSkeleton } from "~types/contentful";

const entries = await contentfulCache.cached(
	async () =>
		contentfulClient.getEntries<TypeLeadersSkeleton>({
			content_type: "leaders",
			include: 2,
			limit: 1000,
		}),
	{ content_type: "leaders", page: "results" },
	10 * 60 * 1000, // 10 minutes cache
);

const players = transformPlayerResults(entries.items);

const url = new URL(Astro.request.url);
const selectedPlayer = url.searchParams.get("playerName") || "";
---

<Layout
	title="Tournament Results | UCSD Casual Golf Club San Diego"
	description="See the latest UCSD Casual Golf Club tournament results, scores, and highlights from our San Diego events."
>
	<Hero title="Player" />
	<div class={styles.subPageWrapper}>
		<PlayerComponent players={players} initialSelectedPlayer={selectedPlayer} client:idle />
	</div>
</Layout>

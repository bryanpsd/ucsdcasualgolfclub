---
import "~/styles/globals/global.css";
import "~/styles/globals/reset.css";
import "~/styles/globals/theme.css";

import { Hero } from "~components/Hero";
import { RichText } from "~components/RichText";

import Layout from "~layouts/Layout.astro";
import { contentfulClient } from "~services/contentful/contentful";
import { contentfulCache } from "~utils/contentfulCache";
import * as styles from "~styles/globals/common.css";
import type { TypeSimplePageSkeleton } from "~types/contentful";

// Get the slug from the URL
const { slug = "" } = Astro.params;

// Fetch the entry matching the slug
const entry = await contentfulCache.cached(
	async () => contentfulClient.getEntries<TypeSimplePageSkeleton>({
		content_type: "simplePage",
		"fields.slug": slug,
		limit: 1,
	}),
	{ content_type: "simplePage", slug },
	15 * 60 * 1000, // 15 minutes cache for simple pages
);

// Handle cases where no entry is found
if (!slug || !entry.items || entry.items.length === 0) {
	return Astro.redirect("/404");
}

// Safely access the fields property
const page = entry.items[0]?.fields || {};
---

<Layout title={`${page.seoTitle} | UCSD Casual Golf Club`} description={page.seoDescription}>
	<Hero title={page.title} />
	<div class={styles.subPageWrapper}>{page.content && <RichText richText={page.content} />}</div>
</Layout>
